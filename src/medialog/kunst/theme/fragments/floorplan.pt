<div id="etasje-kart"
    tal:define="etasjekart context/etasje_kart|None" 
    tal:condition="python: etasjekart!='0'">
<tal:repeat tal:repeat="etasje view/etasje|None">
    <h1>${etasje}. etasje</h1>
    <div id="map${etasje}" class="maps" style="width:100%;"></div>
</tal:repeat>
<script>require([
      '++theme++kunsttheme/javascript/leaflet'
      ], function(Base) {
    <tal:repeat tal:repeat="etasje view/etasje|None">
      var bredde = $('#map${etasje}').width();
      var hoyde = bredde * 678 / 1000;
      var zoom = 678 / hoyde;
      $('#map${etasje}').height(hoyde);
      var map${etasje} = L.map('map${etasje}', 
        { crs: L.CRS.Simple, minZoom:-8, maxZoom:11, scrollWheelZoom: false });
      var bounds = [[0,0], [678, 1000], 0];  
      var image = L.imageOverlay('etasjeplan/etasje0${etasje}/@@images/image/kartutsnitt', bounds).addTo(map${etasje}); 
      map${etasje}.fitBounds(bounds);
      map${etasje}.setView( [339, 450 ], (zoom * -1) + 0.85 );
    </tal:repeat>
    <tal:repeat tal:repeat="line view/latlng|None">
      <tal:define tal:define="words python: line.split(); 
            etasje python: words[0]; 
            lat python: words[1]; 
            lng python: words[2]">
        var plassering = L.latLng([${lat}, ${lng|None}]);
        L.marker(plassering).addTo(map${etasje});
       </tal:define>
    </tal:repeat>  
   });
</script>
    
<style>
    .leaflet-popup-content {width: 130px}
    #map {margin-bottom: 20px; }
    .maps {margin-bottom: 20px; }
</style>
<link rel="stylesheet" href="++theme++kunsttheme/css/leaflet.css" />
</div>